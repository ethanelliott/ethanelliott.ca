<nav class="nav">
  <div class="nav-top-bar">
    <button class="nav-hamburger" id="nav-hamburger" onclick="toggleMobileNav()" aria-label="Toggle navigation">
      <span></span><span></span><span></span>
    </button>
    <% if (typeof stats !== 'undefined' && stats) { %>
    <div class="nav-stats">
      <span class="nav-stat"><%= stats.productCount %> products</span>
      <span class="nav-stat"><%= stats.variantCount %> variants</span>
      <span class="nav-stat">Scanned <%= stats.lastScanFormatted %></span>
    </div>
    <% } %>
  </div>
  <div class="nav-links" id="nav-links">
    <div class="nav-group">
      <a href="/">Newest</a>
      <a href="/products">All Products</a>
      <a href="/sale" class="nav-sale-link">Sale</a>
      <a href="/categories">Categories</a>
      <a href="/restocks">Restocks</a>
      <a href="/colors">Colors</a>
      <a href="/stores">Stores</a>
      <a href="/discontinued">Discontinued</a>
      <a href="/favorites" class="nav-fav-link"
        >&#x2665; Favorites <span id="fav-count" class="fav-badge"></span
      ></a>
    </div>
    <span class="nav-divider">|</span>
    <div class="nav-group nav-group-ai">
      <a href="/ai/search" class="nav-ai-link">ü§ñ AI Search</a>
      <a href="/ai/style" class="nav-ai-link">üëó Style Advisor</a>
      <a href="/ai/deals" class="nav-ai-link">üí∞ Deals Report</a>
    </div>
  </div>
</nav>
<div class="nav-overlay" id="nav-overlay" onclick="closeMobileNav()"></div>
<button
  class="theme-toggle"
  onclick="toggleTheme()"
  title="Toggle dark/light mode"
  id="theme-toggle"
>
  üåô
</button>
<script>
  (function () {
    const saved = localStorage.getItem('theme');
    if (saved === 'light') {
      document.documentElement.style.colorScheme = 'light';
      document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
    } else if (saved === 'dark') {
      document.documentElement.style.colorScheme = 'dark';
      document.getElementById('theme-toggle').textContent = 'üåô';
    }
  })();
  function toggleTheme() {
    const html = document.documentElement;
    const current =
      html.style.colorScheme ||
      (window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light');
    const next = current === 'dark' ? 'light' : 'dark';
    html.style.colorScheme = next;
    localStorage.setItem('theme', next);
    document.getElementById('theme-toggle').textContent =
      next === 'dark' ? 'üåô' : '‚òÄÔ∏è';
  }

  function toggleMobileNav() {
    document.getElementById('nav-links').classList.toggle('nav-open');
    document.getElementById('nav-hamburger').classList.toggle('open');
    document.getElementById('nav-overlay').classList.toggle('visible');
    document.body.classList.toggle('nav-locked');
  }
  function closeMobileNav() {
    document.getElementById('nav-links').classList.remove('nav-open');
    document.getElementById('nav-hamburger').classList.remove('open');
    document.getElementById('nav-overlay').classList.remove('visible');
    document.body.classList.remove('nav-locked');
  }
  // Auto-close drawer when a link is tapped
  document.querySelectorAll('#nav-links a').forEach(function(a) {
    a.addEventListener('click', closeMobileNav);
  });
</script>
