<nav class="nav">
  <div class="nav-top-bar">
    <button
      class="nav-hamburger"
      id="nav-hamburger"
      onclick="toggleMobileNav()"
      aria-label="Toggle navigation"
    >
      <span></span><span></span><span></span>
    </button>
    <% if (typeof stats !== 'undefined' && stats) { %>
    <div class="nav-stats nav-stats-mobile">
      <span class="nav-stat"><%= stats.productCount %> products</span>
      <span class="nav-stat"><%= stats.variantCount %> variants</span>
      <span class="nav-stat">Scanned <%= stats.lastScanFormatted %></span>
    </div>
    <% } %>
  </div>
  <div class="nav-links nav-links-desktop" id="nav-links-desktop">
    <div class="nav-group">
      <a href="/">Newest</a>
      <a href="/products">All Products</a>
      <a href="/sale" class="nav-sale-link">Sale</a>
      <a href="/categories">Categories</a>
      <a href="/restocks">Restocks</a>
      <a href="/colors">Colors</a>
      <a href="/stores">Stores</a>
      <a href="/discontinued">Discontinued</a>
      <a href="/favorites" class="nav-fav-link"
        >&#x2665; Favorites <span id="fav-count" class="fav-badge"></span
      ></a>
    </div>
    <span class="nav-divider">|</span>
    <div class="nav-group nav-group-ai">
      <a href="/ai/search" class="nav-ai-link">ğŸ¤– AI Search</a>
      <a href="/ai/style" class="nav-ai-link">ğŸ‘— Style Advisor</a>
      <a href="/ai/deals" class="nav-ai-link">ğŸ’° Deals Report</a>
    </div>
  </div>
  <% if (typeof stats !== 'undefined' && stats) { %>
  <div class="nav-stats nav-stats-desktop">
    <span class="nav-stat"><%= stats.productCount %> products</span>
    <span class="nav-stat"><%= stats.variantCount %> variants</span>
    <span class="nav-stat">Scanned <%= stats.lastScanFormatted %></span>
  </div>
  <% } %>
</nav>
<!-- Mobile drawer lives outside <nav> to avoid backdrop-filter containing block issues -->
<div class="nav-drawer" id="nav-drawer">
  <div class="nav-group">
    <a href="/">Newest</a>
    <a href="/products">All Products</a>
    <a href="/sale" class="nav-sale-link">Sale</a>
    <a href="/categories">Categories</a>
    <a href="/restocks">Restocks</a>
    <a href="/colors">Colors</a>
    <a href="/stores">Stores</a>
    <a href="/discontinued">Discontinued</a>
    <a href="/favorites" class="nav-fav-link">&#x2665; Favorites</a>
  </div>
  <div class="nav-group nav-group-ai">
    <a href="/ai/search" class="nav-ai-link">ğŸ¤– AI Search</a>
    <a href="/ai/style" class="nav-ai-link">ğŸ‘— Style Advisor</a>
    <a href="/ai/deals" class="nav-ai-link">ğŸ’° Deals Report</a>
  </div>
</div>
<div class="nav-overlay" id="nav-overlay" onclick="closeMobileNav()"></div>
<button
  class="theme-toggle"
  onclick="toggleTheme()"
  title="Toggle dark/light mode"
  id="theme-toggle"
>
  ğŸŒ™
</button>
<script>
  (function () {
    const saved = localStorage.getItem('theme');
    if (saved === 'light') {
      document.documentElement.style.colorScheme = 'light';
      document.getElementById('theme-toggle').textContent = 'â˜€ï¸';
    } else if (saved === 'dark') {
      document.documentElement.style.colorScheme = 'dark';
      document.getElementById('theme-toggle').textContent = 'ğŸŒ™';
    }
  })();
  function toggleTheme() {
    const html = document.documentElement;
    const current =
      html.style.colorScheme ||
      (window.matchMedia('(prefers-color-scheme: dark)').matches
        ? 'dark'
        : 'light');
    const next = current === 'dark' ? 'light' : 'dark';
    html.style.colorScheme = next;
    localStorage.setItem('theme', next);
    document.getElementById('theme-toggle').textContent =
      next === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
  }

  function toggleMobileNav() {
    document.getElementById('nav-drawer').classList.toggle('nav-open');
    document.getElementById('nav-hamburger').classList.toggle('open');
    document.getElementById('nav-overlay').classList.toggle('visible');
    document.body.classList.toggle('nav-locked');
  }
  function closeMobileNav() {
    document.getElementById('nav-drawer').classList.remove('nav-open');
    document.getElementById('nav-hamburger').classList.remove('open');
    document.getElementById('nav-overlay').classList.remove('visible');
    document.body.classList.remove('nav-locked');
  }
  // Auto-close drawer when a link is tapped
  document.querySelectorAll('#nav-drawer a').forEach(function (a) {
    a.addEventListener('click', closeMobileNav);
  });
</script>
