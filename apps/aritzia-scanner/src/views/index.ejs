<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title %> - Aritzia Scanner</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <%- include('partials/nav') %>

    <h1><%= title %></h1>

    <% if (locals.brands && brands.length > 0) { %>
    <div class="filter-container" style="margin-bottom: 20px;">
      <form action="" method="GET">
        <label for="brand">Filter by Brand:</label>
        <select name="brand" id="brand" onchange="this.form.submit()">
          <option value="">All Brands</option>
          <% brands.forEach(brand => { %>
          <option value="<%= brand %>" <%= locals.currentBrand === brand ? 'selected' : '' %>><%= brand %></option>
          <% }); %>
        </select>
      </form>
    </div>
    <% } %>

    <% if (activeProducts && activeProducts.length > 0) { %>
    <h2>Active Products</h2>
    <div class="product-grid">
      <% activeProducts.forEach(product => { %> <% const link =
      product.isVariant ?
      `/product/${product.product_id}/variant/${product.color_id}` :
      `/product/${product.id}`; const subtext = product.isVariant ?
      `${product.color} (${product.length})` : ''; %>
      <div class="product-card">
        <a href="<%= link %>" class="product-image">
          <% if (product.thumbnail_id) { %>
          <img
            src="/api/images/<%= product.thumbnail_id %>"
            alt="<%= product.name %>"
            loading="lazy"
          />
          <% } else { %>
          <span class="no-image-placeholder">No Image</span>
          <% } %>
        </a>
        <div class="product-info">
          <a href="<%= link %>" class="product-name"><%= product.name %></a>
          <% if (product.price) { %>
          <div class="product-price-container">
            <% if (product.price < product.list_price) { %>
            <span class="price-sale">$<%= product.price %></span>
            <span class="price-list">$<%= product.list_price %></span>
            <% } else { %>
            <span>$<%= product.price %></span>
            <% } %>
          </div>
          <% } %> <% if (subtext) { %>
          <div class="variant-details"><%= subtext %></div>
          <% } %> <% if (product.added_at_formatted) { %>
          <div class="product-meta">
            Added <%= product.added_at_formatted %>
          </div>
          <% } %>
        </div>
      </div>
      <% }); %>
    </div>
    <% } %> <% if (discontinuedProducts && discontinuedProducts.length > 0) { %>
    <h2>Discontinued Products</h2>
    <div class="product-grid">
      <% discontinuedProducts.forEach(product => { %> <% const link =
      product.isVariant ?
      `/product/${product.product_id}/variant/${product.color_id}` :
      `/product/${product.id}`; const subtext = product.isVariant ?
      `${product.color} (${product.length})` : ''; %>
      <div class="product-card discontinued">
        <a href="<%= link %>" class="product-image">
          <% if (product.thumbnail_id) { %>
          <img
            src="/api/images/<%= product.thumbnail_id %>"
            alt="<%= product.name %>"
            loading="lazy"
          />
          <% } else { %>
          <span class="no-image-placeholder">No Image</span>
          <% } %>
        </a>
        <div class="product-info">
          <a href="<%= link %>" class="product-name"><%= product.name %></a>
          <% if (product.price) { %>
          <div class="product-price-container">
            <% if (product.price < product.list_price) { %>
            <span class="price-sale">$<%= product.price %></span>
            <span class="price-list">$<%= product.list_price %></span>
            <% } else { %>
            <span>$<%= product.price %></span>
            <% } %>
          </div>
          <% } %> <% if (subtext) { %>
          <div class="variant-details"><%= subtext %></div>
          <% } %>
          <div class="discontinued-badge">Discontinued</div>
          <% if (product.added_at_formatted) { %>
          <div class="product-meta">
            Added <%= product.added_at_formatted %>
          </div>
          <% } %>
        </div>
      </div>
      <% }); %>
    </div>
    <% } %> <% if (showAllLink) { %>
    <div class="view-all-container">
      <a href="/products" class="view-all-button">View All Products</a>
    </div>
    <% } %>
  </body>
</html>
