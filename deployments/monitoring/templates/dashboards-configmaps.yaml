{{- $labelKey := default "grafana_dashboard" .Values.dashboardLabelKey -}}
{{- $labelValue := default "1" .Values.dashboardLabelValue -}}
{{- $dashboards := .Files.Glob "dashboards/*.json" -}}
{{- if $dashboards }}
{{- $dashboardPaths := list -}}
{{- range $path, $_ := $dashboards }}
{{- $dashboardPaths = append $dashboardPaths $path -}}
{{- end }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "monitoring.fullname" . }}-dashboards
  labels:
    {{- include "monitoring.labels" . | nindent 4 }}
    {{ $labelKey }}: {{ $labelValue | quote }}
data:
{{- range $path := sortAlpha $dashboardPaths }}
  {{ base $path }}: |
{{ printf "%s" (index $dashboards $path) | indent 4 }}
{{- end }}
{{- end }}
