{{- $labelKey := default "grafana_dashboard" .Values.dashboardLabelKey -}}
{{- $labelValue := default "1" .Values.dashboardLabelValue -}}
{{- $dashboards := .Files.Glob "dashboards/*.json" -}}
{{- range $path, $_ := $dashboards }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "monitoring.fullname" $ }}-dashboard-{{ base $path | replace "." "-" | lower | trunc 63 | trimSuffix "-" }}
  labels:
    {{- include "monitoring.labels" $ | nindent 4 }}
    {{ $labelKey }}: {{ $labelValue | quote }}
data:
  {{ base $path }}: |
{{ $.Files.Get $path | indent 4 }}
{{- end }}
