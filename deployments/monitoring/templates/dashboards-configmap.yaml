apiVersion: v1
kind: List
items:
{{- range $index, $file := .Values.dashboards }}
{{- $path := printf "dashboards/%s" $file -}}
{{- $matches := $.Files.Glob $path -}}
{{- if not $matches }}
{{- fail (printf "dashboard file %s not found" $path) -}}
{{- end }}
{{- $content := $.Files.Get $path -}}
  - apiVersion: v1
    kind: ConfigMap
    metadata:
      name: {{ include "monitoring.dashboardConfigMapName" (dict "file" $file "context" $) }}
      labels:
        {{- include "monitoring.labels" $ | nindent 8 }}
        grafana_dashboard: "true"
      annotations:
        grafanaFolder: cluster
        dashboards.monitoring.elliott.haus/origin: "git"
        dashboards.monitoring.elliott.haus/file: {{ $file | quote }}
    data:
      {{ $file }}: |
{{ $content | indent 8 }}
{{- end }}
